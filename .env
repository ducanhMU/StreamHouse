# ==============================================================================
# JADC2 Big Data Pipeline with Governance - Environment Configuration
# ==============================================================================

# ------------------------------------------------------------------------------
# OpenMetadata Configuration
# ------------------------------------------------------------------------------
# IMPORTANT: After first startup, obtain JWT token from OpenMetadata UI:
# 1. Access http://localhost:8585 (user: admin / pass: admin)
# 2. Navigate to Settings -> Bots -> ingestion-bot
# 3. Generate new token with "No Expiry"
# 4. Copy token and paste below
# 5. Restart Spark jobs: docker-compose restart spark-job-ingest spark-job-process
#
# NOTE: The get_om_token.sh script attempts to auto-fetch this token.
# If auto-auth fails, manually set the token here as a fallback.
OM_JWT_TOKEN=

# OpenMetadata Server
OPENMETADATA_CLUSTER_NAME=openmetadata
SERVER_PORT=8585
SERVER_ADMIN_PORT=8586
LOG_LEVEL=INFO

# ------------------------------------------------------------------------------
# Database Configuration
# ------------------------------------------------------------------------------
# PostgreSQL Source (Bronze Layer - OLTP)
POSTGRES_SOURCE_HOST=postgres-source
POSTGRES_SOURCE_PORT=5432
POSTGRES_SOURCE_DB=jadc2_db
POSTGRES_SOURCE_USER=admin
POSTGRES_SOURCE_PASSWORD=password

# PostgreSQL Destination (Gold Layer - OLAP)
POSTGRES_DEST_HOST=postgres-dest
POSTGRES_DEST_PORT=5432
POSTGRES_DEST_DB=jadc2_db
POSTGRES_DEST_USER=admin
POSTGRES_DEST_PASSWORD=password

# OpenMetadata MySQL Backend
DB_DRIVER_CLASS=com.mysql.cj.jdbc.Driver
DB_SCHEME=mysql
DB_PARAMS=allowPublicKeyRetrieval=true&useSSL=false&serverTimezone=UTC
DB_USER=openmetadata_user
DB_USER_PASSWORD=openmetadata_password
DB_HOST=om-mysql
DB_PORT=3306
OM_DATABASE=openmetadata_db

# Hive Metastore Database
HMS_DB_HOST=hms-db
HMS_DB_PORT=5432
HMS_DB_NAME=hms
HMS_DB_USER=hive
HMS_DB_PASSWORD=hive

# Airflow Database
AIRFLOW_DB_HOST=om-mysql
AIRFLOW_DB_PORT=3306
AIRFLOW_DB=airflow_db
AIRFLOW_DB_SCHEME=mysql+mysqldb
AIRFLOW_DB_USER=airflow_user
AIRFLOW_DB_PASSWORD=airflow_pass

# ------------------------------------------------------------------------------
# Kafka Configuration
# ------------------------------------------------------------------------------
KAFKA_BOOTSTRAP_SERVERS=kafka:9092
KAFKA_ZOOKEEPER_CONNECT=zookeeper:2181
KAFKA_BROKER_ID=1
KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR=1
KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR=1
KAFKA_TRANSACTION_STATE_LOG_MIN_ISR=1

# ------------------------------------------------------------------------------
# HDFS Configuration
# ------------------------------------------------------------------------------
HDFS_NAMENODE_HOST=namenode
HDFS_NAMENODE_PORT=9000
HDFS_NAMENODE_HTTP_PORT=9870
HDFS_REPLICATION_FACTOR=1
HDFS_BASE_PATH=hdfs://namenode:9000/data/delta

# ------------------------------------------------------------------------------
# Spark Configuration
# ------------------------------------------------------------------------------
SPARK_MASTER_HOST=spark-master
SPARK_MASTER_PORT=7077
SPARK_MASTER_WEBUI_PORT=8080
SPARK_WORKER_CORES=2
SPARK_WORKER_MEMORY=2g
SPARK_RPC_AUTHENTICATION_SECRET=my-secret

# ------------------------------------------------------------------------------
# Elasticsearch Configuration
# ------------------------------------------------------------------------------
ELASTICSEARCH_HOST=om-elasticsearch
ELASTICSEARCH_PORT=9200
ELASTICSEARCH_SCHEME=http
SEARCH_TYPE=elasticsearch
ELASTICSEARCH_CONNECTION_TIMEOUT_SECS=5
ELASTICSEARCH_SOCKET_TIMEOUT_SECS=60

# ------------------------------------------------------------------------------
# Authentication & Security
# ------------------------------------------------------------------------------
# OpenMetadata Auth
AUTHORIZER_CLASS_NAME=org.openmetadata.service.security.DefaultAuthorizer
AUTHORIZER_REQUEST_FILTER=org.openmetadata.service.security.JwtFilter
AUTHORIZER_ADMIN_PRINCIPALS=[admin]
AUTHORIZER_INGESTION_PRINCIPALS=[ingestion-bot]
AUTHORIZER_PRINCIPAL_DOMAIN=open-metadata.org
AUTHENTICATION_PROVIDER=basic
AUTHENTICATION_PUBLIC_KEYS=[http://om-server:8585/api/v1/system/config/jwks]
AUTHENTICATION_ENABLE_SELF_SIGNUP=true

# JWT Configuration
RSA_PUBLIC_KEY_FILE_PATH=./conf/public_key.der
RSA_PRIVATE_KEY_FILE_PATH=./conf/private_key.der
JWT_ISSUER=open-metadata.org
JWT_KEY_ID=Gb389a-9f76-gdjs-a92j-0242bk94356

# Airflow Auth
AIRFLOW_USERNAME=admin
AIRFLOW_PASSWORD=admin
FERNET_KEY=jJ/9sz0g0OHxsfxOoSfdFdmk3ysNmPRnH3TUAbz3IHA=

# ------------------------------------------------------------------------------
# Pipeline Service Configuration
# ------------------------------------------------------------------------------
PIPELINE_SERVICE_CLIENT_ENABLED=true
PIPELINE_SERVICE_CLIENT_CLASS_NAME=org.openmetadata.service.clients.pipeline.airflow.AirflowRESTClient
PIPELINE_SERVICE_CLIENT_ENDPOINT=http://om-ingestion:8080
SERVER_HOST_API_URL=http://om-server:8585/api
PIPELINE_SERVICE_CLIENT_VERIFY_SSL=no-ssl

# ------------------------------------------------------------------------------
# Data Generator Configuration
# ------------------------------------------------------------------------------
CONTINUOUS_RUN=true
LOOP_INTERVAL_SECONDS=300

# ------------------------------------------------------------------------------
# Resource Limits & Performance Tuning
# ------------------------------------------------------------------------------
# OpenMetadata Heap
OPENMETADATA_HEAP_OPTS=-Xmx1G -Xms1G

# Elasticsearch Heap
ES_JAVA_OPTS=-Xms1024m -Xmx1024m

# Migration Settings
MIGRATION_LIMIT_PARAM=1200

# ------------------------------------------------------------------------------
# Secrets Manager Configuration
# ------------------------------------------------------------------------------
SECRET_MANAGER=db

# ------------------------------------------------------------------------------
# Monitoring & Logging
# ------------------------------------------------------------------------------
EVENT_MONITOR=prometheus
EVENT_MONITOR_BATCH_SIZE=10

# ------------------------------------------------------------------------------
# Advanced Features (Optional)
# ------------------------------------------------------------------------------
# Mask passwords in UI
MASK_PASSWORDS_API=false

# Enable SMTP for email notifications
AUTHORIZER_ENABLE_SMTP=false

# ------------------------------------------------------------------------------
# Network Configuration
# ------------------------------------------------------------------------------
# All services communicate via the 'jadc2' Docker bridge network
# External port mappings:
#   - PostgreSQL Source:    5433 -> 5432
#   - PostgreSQL Dest:      5434 -> 5432
#   - Kafka:                9092, 29092 (host)
#   - Kafka UI:             8085 -> 8080
#   - Debezium:             8083
#   - HDFS NameNode UI:     9870
#   - Spark Master UI:      8082 -> 8080
#   - Spark Worker UI:      8081
#   - OpenMetadata UI:      8585
#   - OpenMetadata Admin:   8586
#   - Airflow UI:           8081 -> 8080
#   - Hive Metastore:       9083
#   - Elasticsearch:        9200, 9300

# ==============================================================================
# NOTES:
# ==============================================================================
# 1. After first deployment, manually configure OM_JWT_TOKEN (see instructions above)
# 2. For production, change all passwords and secrets
# 3. Increase SPARK_WORKER_MEMORY and CORES for heavy workloads
# 4. Monitor Docker resources: at least 12GB RAM recommended
# 5. For clustering, adjust replication factors (Kafka, HDFS)
# 6. Enable SSL/TLS for production by updating verification settings
# ==============================================================================